import tkinter as tk
import os
import time
import RPi.GPIO as GPIO

GPIO.setmode(GPIO.BOARD)
GPIO.cleanup()

# Define GPIO pins
pin_numbers = [3, 5, 7, 11, 13, 15, 19]
for pin in pin_numbers:
    GPIO.setup(pin, GPIO.OUT)

def buttonFunc():
    print("Button Pressed")
    
    for pin in pin_numbers:
        GPIO.output(pin, 1)
        time.sleep(0.5)
        command_success = False
        retries = 0
        letter = 'a'
        
        while not command_success and retries < 2:
            os.system("sudo /home/pi/usbboot/rpiboot")
            
            fileName = f'/dev/sd{letter}'
            if os.path.exists(fileName):
                command_success = True
                print(f"Device found at {fileName}")
            else:
                print(f"Retrying command for pin {pin} (Attempt {retries + 1})")
                retries += 1
                letter = chr(ord(letter) + 1)  # Move to the next letter
            
            if command_success:
                print(f"Command succeeded on pin {pin}")
                break

        if not command_success:
            print(f"Command failed on pin {pin} after 2 attempts")
        else:
            break

# Set up the GUI
window = tk.Tk()
window.geometry("800x800")

button = tk.Button(window, text="Run Command", command=buttonFunc)
button.pack(padx=20, pady=20)

window.mainloop()
